<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Bệnh Viện</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #ff7e5f;
            --dark-color: #2c3e50;
            --light-color: #f8f9fa;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7ff;
            color: var(--dark-color);
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .logo {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s;
        }
        
        .main-title {
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-top: 1rem;
        }
        
        .nav-tabs .nav-link {
            font-weight: 600;
            color: var(--dark-color);
            border: none;
            padding: 12px 20px;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background-color: transparent;
        }
        
        .tab-content {
            background-color: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 15px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background-color: #3a5bef;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success {
            background-color: var(--success-color);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
            color: #212529;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        
        .table {
            margin-bottom: 0;
        }
        
        .table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(74, 107, 255, 0.05);
        }
        
        .status-active {
            background-color: rgba(40, 167, 69, 0.1);
            color: var(--success-color);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .status-inactive {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--danger-color);
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .form-container {
            background-color: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 2rem;
        }
        
        .was-validated .form-control:invalid, .form-control.is-invalid {
            border-color: var(--danger-color);
        }
        
        .invalid-feedback {
            color: var(--danger-color);
            font-size: 0.875em;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header class="header text-center">
        <div class="container">
            <img src="https://cdn-icons-png.flaticon.com/512/2969/2969398.png" alt="Logo Bệnh Viện" class="logo mb-3">
            <h1 class="main-title">HỆ THỐNG QUẢN LÝ BỆNH VIỆN</h1>
            <p class="lead">Quản lý bệnh nhân, phòng khám và lịch hẹn</p>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="patients-tab" data-bs-toggle="tab" data-bs-target="#patients" type="button" role="tab">Bệnh nhân</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="clinics-tab" data-bs-toggle="tab" data-bs-target="#clinics" type="button" role="tab">Phòng khám</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="appointments-tab" data-bs-toggle="tab" data-bs-target="#appointments" type="button" role="tab">Lịch hẹn</button>
            </li>
        </ul>
        
        <!-- Tab Contents -->
        <div class="tab-content" id="myTabContent">
            <!-- Patients Tab -->
            <div class="tab-pane fade show active" id="patients" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3><i class="fas fa-user-injured me-2"></i>Quản lý Bệnh nhân</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPatientModal">
                        <i class="fas fa-plus me-2"></i>Thêm bệnh nhân
                    </button>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Tên bệnh nhân</th>
                                <th>Số điện thoại</th>
                                <th>Lần cuối khám</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="benhNhan, stat : ${danhSachBenhNhan}">
                                <td th:text="${stat.index + 1}"></td>
                                <td th:text="${benhNhan.ten}"></td>
                                <td th:text="${benhNhan.soDienThoai}"></td>
                                <td>Chưa có dữ liệu</td>
                                <td>
                                    <button class="btn btn-sm btn-danger" th:onclick="'deletePatient(' + ${stat.index} + ')'">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Clinics Tab -->
            <div class="tab-pane fade" id="clinics" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3><i class="fas fa-clinic-medical me-2"></i>Quản lý Phòng khám</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addClinicModal">
                        <i class="fas fa-plus me-2"></i>Thêm phòng khám
                    </button>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Tên phòng</th>
                                <th>Chuyên khoa</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="phongKham, stat : ${danhSachPhongKham}">
                                <td th:text="${stat.index + 1}"></td>
                                <td th:text="${phongKham.tenPhong}"></td>
                                <td th:text="${phongKham.chuyenKhoa}"></td>
                                <td><span class="status-active">Hoạt động</span></td>
                                <td>
                                    <button class="btn btn-sm btn-danger" th:onclick="'deleteClinic(' + ${stat.index} + ')'">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Appointments Tab -->
            <div class="tab-pane fade" id="appointments" role="tabpanel">
                <h3 class="mb-4"><i class="fas fa-calendar-check me-2"></i>Quản lý Lịch hẹn</h3>
                
                <div class="form-container">
                    <h4><i class="fas fa-plus-circle me-2"></i>Tạo lịch hẹn mới</h4>
                    <form id="appointmentForm" th:action="@{/themGiaoDich}" method="post" novalidate>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Bệnh nhân</label>
                                <select class="form-select" name="benhNhanIndex" required>
                                    <option value="" selected disabled>-- Chọn bệnh nhân --</option>
                                    <option th:each="benhNhan, stat : ${danhSachBenhNhan}" 
                                            th:value="${stat.index}"
                                            th:text="${benhNhan.ten} + ' - ' + ${benhNhan.soDienThoai}">
                                    </option>
                                </select>
                                <div class="invalid-feedback">Vui lòng chọn bệnh nhân</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Phòng khám</label>
                                <select class="form-select" name="phongKhamIndex" required>
                                    <option value="" selected disabled>-- Chọn phòng khám --</option>
                                    <option th:each="phongKham, stat : ${danhSachPhongKham}" 
                                            th:value="${stat.index}"
                                            th:text="${phongKham.tenPhong} + ' (' + ${phongKham.chuyenKhoa} + ')'">
                                    </option>
                                </select>
                                <div class="invalid-feedback">Vui lòng chọn phòng khám</div>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Ngày hẹn</label>
                                <input type="date" class="form-control" name="ngayHen" required>
                                <div class="invalid-feedback">Vui lòng chọn ngày hẹn</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Giờ hẹn</label>
                                <input type="time" class="form-control" name="gioHen" required>
                                <div class="invalid-feedback">Vui lòng chọn giờ hẹn</div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Ghi chú</label>
                            <textarea class="form-control" name="ghiChu" rows="2"></textarea>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Lưu lịch hẹn
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>Bệnh nhân</th>
                                <th>Phòng khám</th>
                                <th>Thời gian</th>
                                <th>Trạng thái</th>
                                <th>Hành động</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="giaoDich, stat : ${danhSachGiaoDich}">
                                <td th:text="${stat.index + 1}"></td>
                                <td th:text="${giaoDich.benhNhan.ten} + ' - ' + ${giaoDich.benhNhan.soDienThoai}"></td>
                                <td th:text="${giaoDich.phongKham.tenPhong} + ' (' + ${giaoDich.phongKham.chuyenKhoa} + ')'"></td>
                                <td th:text="${giaoDich.thoiGian}"></td>
                                <td><span class="status-active">Đã đặt</span></td>
                                <td>
                                    <button class="btn btn-sm btn-danger" th:onclick="'deleteAppointment(' + ${stat.index} + ')'">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Patient Modal -->
    <div class="modal fade" id="addPatientModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Thêm bệnh nhân mới</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="patientForm" th:action="@{/themBenhNhan}" method="post" novalidate>
                        <div class="mb-3">
                            <label class="form-label">Tên bệnh nhân</label>
                            <input type="text" class="form-control" name="ten" required minlength="3">
                            <div class="invalid-feedback">Vui lòng nhập tên bệnh nhân (ít nhất 3 ký tự)</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Số điện thoại</label>
                            <input type="text" class="form-control" name="soDienThoai" required 
                                   pattern="[0-9]{10}" title="Số điện thoại 10 chữ số">
                            <div class="invalid-feedback">Vui lòng nhập số điện thoại hợp lệ (10 chữ số)</div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                            <button type="submit" class="btn btn-primary">Lưu bệnh nhân</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Clinic Modal -->
    <div class="modal fade" id="addClinicModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Thêm phòng khám mới</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="clinicForm" th:action="@{/themPhongKham}" method="post" novalidate>
                        <div class="mb-3">
                            <label class="form-label">Tên phòng</label>
                            <input type="text" class="form-control" name="tenPhong" required minlength="3">
                            <div class="invalid-feedback">Vui lòng nhập tên phòng (ít nhất 3 ký tự)</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Chuyên khoa</label>
                            <input type="text" class="form-control" name="chuyenKhoa" required>
                            <div class="invalid-feedback">Vui lòng nhập chuyên khoa</div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                            <button type="submit" class="btn btn-primary">Lưu phòng khám</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Xử lý validate form
        (function() {
            'use strict';
            
            // Lấy tất cả các form cần validate
            const forms = document.querySelectorAll('.needs-validation');
            
            // Lặp lại và ngăn chặn submit nếu không hợp lệ
            Array.from(forms).forEach(function(form) {
                form.addEventListener('submit', function(event) {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
            
            // Validate form thêm bệnh nhân
            const patientForm = document.getElementById('patientForm');
            if (patientForm) {
                patientForm.addEventListener('submit', function(event) {
                    if (!patientForm.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    patientForm.classList.add('was-validated');
                });
            }
            
            // Validate form thêm phòng khám
            const clinicForm = document.getElementById('clinicForm');
            if (clinicForm) {
                clinicForm.addEventListener('submit', function(event) {
                    if (!clinicForm.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    clinicForm.classList.add('was-validated');
                });
            }
            
            // Validate form lịch hẹn
            const appointmentForm = document.getElementById('appointmentForm');
            if (appointmentForm) {
                appointmentForm.addEventListener('submit', function(event) {
                    if (!appointmentForm.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    appointmentForm.classList.add('was-validated');
                });
            }
        })();
        
        function deletePatient(index) {
            if (confirm('Bạn có chắc chắn muốn xóa bệnh nhân này?')) {
                window.location.href = '/xoaBenhNhan/' + index;
            }
        }
        
        function deleteClinic(index) {
            if (confirm('Bạn có chắc chắn muốn xóa phòng khám này?')) {
                window.location.href = '/xoaPhongKham/' + index;
            }
        }
        
        function deleteAppointment(index) {
            if (confirm('Bạn có chắc chắn muốn xóa lịch hẹn này?')) {
                window.location.href = '/xoaGiaoDich/' + index;
            }
        }
        
        // Tự động đóng modal sau khi submit thành công
        document.addEventListener('DOMContentLoaded', function() {
            const patientModal = document.getElementById('addPatientModal');
            if (patientModal) {
                patientModal.addEventListener('hidden.bs.modal', function() {
                    const form = document.getElementById('patientForm');
                    if (form) {
                        form.reset();
                        form.classList.remove('was-validated');
                    }
                });
            }
            
            const clinicModal = document.getElementById('addClinicModal');
            if (clinicModal) {
                clinicModal.addEventListener('hidden.bs.modal', function() {
                    const form = document.getElementById('clinicForm');
                    if (form) {
                        form.reset();
                        form.classList.remove('was-validated');
                    }
                });
            }
        });
    </script>
</body>
</html>